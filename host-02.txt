-------------
Host02-VM2
-------------

$ sudo apt update
$ sudo apt install -y docker.io
$ sudo docker pull ubuntu
$ ip link
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 0a:f5:a4:e1:3a:c2 brd ff:ff:ff:ff:ff:ff
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default 
    link/ether 02:42:9f:18:ff:df brd ff:ff:ff:ff:ff:ff

sudo docker network create --subnet 172.18.0.0/16 vxlan-net
c485be328b349a64ab32f1743658e09d16d39b3fef83946bbfad662831a92a33
$ sudo docker network ls
NETWORK ID     NAME        DRIVER    SCOPE
6e1b56c794c3   bridge      bridge    local
d1f9b80443c4   host        host      local
922f1ff12422   none        null      local
c485be328b34   vxlan-net   bridge    local
$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc fq_codel state UP group default qlen 1000
    link/ether 0a:05:59:dc:14:18 brd ff:ff:ff:ff:ff:ff
    inet 10.0.1.41/24 brd 10.0.1.255 scope global dynamic eth0
       valid_lft 1984sec preferred_lft 1984sec
    inet6 fe80::805:59ff:fedc:1418/64 scope link 
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:57:11:86:a0 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
4: br-c485be328b34: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:29:42:6b:94 brd ff:ff:ff:ff:ff:ff
    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c485be328b34
       valid_lft forever preferred_lft forever
       
       
$ sudo docker run -d --net vxlan-net --ip 172.18.0.12 ubuntu sleep 3000
7755c18d3550d1fd80d0d00d9dce85dfd8370b2d26cbc088c97bd1b91ac95be7
ubuntu@ip-10-0-1-41:~$ sudo docker ps
CONTAINER ID   IMAGE     COMMAND        CREATED         STATUS         PORTS     NAMES
7755c18d3550   ubuntu    "sleep 3000"   9 seconds ago   Up 8 seconds             affectionate_black

$ sudo docker inspect 77 | grep IPAddress
            "SecondaryIPAddresses": null,
            "IPAddress": "",
                    "IPAddress": "172.18.0.12",

$ ping 172.18.0.11 -c 2
PING 172.18.0.11 (172.18.0.11) 56(84) bytes of data.
From 172.18.0.1 icmp_seq=1 Destination Host Unreachable
From 172.18.0.1 icmp_seq=2 Destination Host Unreachable

--- 172.18.0.11 ping statistics ---
2 packets transmitted, 0 received, +2 errors, 100% packet loss, time 1005ms
pipe 2

$ sudo docker exec -it 77 bash

	# apt-get update
	# apt-get install net-tools
	# apt-get install iputils-ping
	# ping 172.18.0.11 -c 2
	PING 172.18.0.11 (172.18.0.11) 56(84) bytes of data.
	--- 172.18.0.11 ping statistics ---
	2 packets transmitted, 0 received, 100% packet loss, time 2028ms
	
-----------------
VXLAN
-----------------

ubuntu@ip-10-0-1-41:~$ brctl show
bridge name	bridge id		STP enabled	interfaces
br-c485be328b34		8000.024229426b94	no		veth478bcd1
docker0		8000.0242571186a0	no		
ubuntu@ip-10-0-1-41:~$ sudo ip link add vxlan-demo type vxlan id 100 remote 10.0.1.4 dstport 4789 dev eth0
ubuntu@ip-10-0-1-41:~$ ip a | grep vxlan
9: vxlan-demo: <BROADCAST,MULTICAST> mtu 8951 qdisc noop state DOWN group default qlen 1000
ubuntu@ip-10-0-1-41:~$ sudo ip link set vxlan-demo up
ubuntu@ip-10-0-1-41:~$ sudo brctl addif br-c485be328b34 vxlan-demo

$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.0.1.1        0.0.0.0         UG    100    0        0 eth0
10.0.1.0        0.0.0.0         255.255.255.0   U     0      0        0 eth0
10.0.1.1        0.0.0.0         255.255.255.255 UH    100    0        0 eth0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-c485be328b34

------------------
Connectivity TEST
------------------

$ sudo docker exec -it 77 bash
	# ping 172.18.0.11 -c 2
	PING 172.18.0.11 (172.18.0.11) 56(84) bytes of data.
	64 bytes from 172.18.0.11: icmp_seq=1 ttl=64 time=0.601 ms
	64 bytes from 172.18.0.11: icmp_seq=2 ttl=64 time=0.601 ms

	--- 172.18.0.11 ping statistics ---
	2 packets transmitted, 2 received, 0% packet loss, time 1018ms
	rtt min/avg/max/mdev = 0.601/0.601/0.601/0.000 ms
	
	# ping 172.18.0.1 -c 2
	PING 172.18.0.1 (172.18.0.1) 56(84) bytes of data.
	64 bytes from 172.18.0.1: icmp_seq=1 ttl=64 time=0.062 ms
	64 bytes from 172.18.0.1: icmp_seq=2 ttl=64 time=0.080 ms

	--- 172.18.0.1 ping statistics ---
	2 packets transmitted, 2 received, 0% packet loss, time 1032ms
	rtt min/avg/max/mdev = 0.062/0.071/0.080/0.009 ms

